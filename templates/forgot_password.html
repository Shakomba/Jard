{% extends "base.html" %}
{% block content %}
<style>
  .field-error {
    border-color: #FF453A !important;
    outline: 2px solid rgba(255, 69, 58, 0.4) !important;
    outline-offset: 0px !important;
  }
  .field-error:focus {
    outline: 2px solid rgba(255, 69, 58, 0.6) !important;
    box-shadow: 0 0 0 3px rgba(255, 69, 58, 0.2) !important;
  }
  .shake {
    animation: shake 0.28s ease-in-out;
  }
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    50% { transform: translateX(4px); }
    75% { transform: translateX(-3px); }
    100% { transform: translateX(0); }
  }
  .error-message {
    color: #ff4444 !important;
    font-weight: 500 !important;
  }
</style>
<div class="flex flex-col items-center gap-8 py-20">
  <div class="card rounded-3xl p-8 w-full max-w-xl text-center">
    <div class="mb-6">
      <svg class="w-16 h-16 mx-auto text-violet-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.169.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/>
      </svg>
    </div>
    <h1 class="text-3xl font-bold">{{ t('reset.request_title') }}</h1>
  <p class="mt-2 text-sm text-slate-300">{{ t('reset.request_help') }}</p>

  <form id="forgotPasswordForm" class="mt-6 space-y-4" method="post" action="{{ url_for('forgot_password_post') }}">
    <div>
      <label style="text-align: {{ 'right' if lang == 'ku' else 'left' }} !important;" class="block w-full text-sm text-slate-200" dir="{{ 'rtl' if lang == 'ku' else 'ltr' }}">{{ t('reset.email_label') }}</label>
      <input id="forgotEmail" name="email" type="email" required autocomplete="email" autocapitalize="none" spellcheck="false"
             class="mt-1 w-full px-4 py-3 rounded-2xl input focus:outline-none focus:ring-2 focus:ring-violet-400"
             placeholder="{{ t('reset.email_placeholder') }}" dir="ltr" />
      <div id="emailError" style="text-align: {{ 'right' if lang == 'ku' else 'left' }} !important;" class="mt-1 text-xs error-message hidden" dir="{{ 'rtl' if lang == 'ku' else 'ltr' }}"></div>
    </div>

    <button type="submit" class="w-full py-3 rounded-2xl bg-violet-500 hover:bg-violet-400 transition font-semibold">
      {{ t('reset.request_button') }}
    </button>
  </form>

  <div class="mt-4 text-sm text-slate-300">
    <a class="text-violet-300 font-semibold" href="{{ url_for('login') }}">{{ t('login.title') }}</a>
  </div>
</div>
</div>

<script>
  (function() {
    const form = document.getElementById('forgotPasswordForm');
    const emailInput = document.getElementById('forgotEmail');
    const emailError = document.getElementById('emailError');
    const submitButton = form.querySelector('button[type="submit"]');

    // Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    // Clear errors when user starts typing
    emailInput.addEventListener('input', function() {
      emailInput.classList.remove('field-error', 'shake');
      emailError.classList.add('hidden');
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      // Clear previous errors
      emailInput.classList.remove('field-error', 'shake');
      emailError.classList.add('hidden');

      // Validate email
      const email = emailInput.value.trim();
      if (!email) {
        emailInput.classList.add('field-error', 'shake');
        emailError.textContent = '{{ t("login.email_required") }}';
        emailError.classList.remove('hidden');
        emailInput.focus();
        return;
      } else if (!emailRegex.test(email)) {
        emailInput.classList.add('field-error', 'shake');
        emailError.textContent = '{{ t("login.email_invalid") }}';
        emailError.classList.remove('hidden');
        emailInput.focus();
        return;
      }

      // Submit the form normally
      submitButton.disabled = true;
      submitButton.textContent = '{{ t("common.sending") }}...';
      form.submit();
    });
  })();
</script>
{% endblock %}
